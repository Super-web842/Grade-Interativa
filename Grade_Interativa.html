<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Interativa com Persistência</title>
    <style>
        /* Estilos CSS (Não alterados, apenas para referência) */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        
        .info-panel {
            margin: 20px 0;
            padding: 15px 30px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        .info-panel h2 {
            margin-top: 0;
            color: #333;
        }
        .info-panel p {
            font-size: 1.1em;
            margin: 5px 0;
        }
        .total-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }

        /* Estilos da Grade */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            grid-template-rows: repeat(10, 40px);
            border: 2px solid black;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
        }
        .grid-item {
            width: 40px;
            height: 40px;
            background-color: white;
            border: 1px solid black;
            cursor: pointer;
            transition: background-color 0.3s ease;
            
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: bold;
            color: transparent;
            user-select: none;
        }
        
        .pintado {
            background-color: #4CAF50;
            color: white;
            border-color: #388E3C;
        }
    </style>
</head>
<body>

    <div class="info-panel">
        <h2>Progresso da Grade</h2>
        <p>Valor Total Arrecadado: <span id="total-value" class="total-value">R$ 0,00</span></p>
        <p>Quadrados Preenchidos: <span id="progress-percentage">0%</span></p>
    </div>

    <div class="grid-container" id="interactive-grid">
        </div>

    <script>
        // *** VARIÁVEIS GLOBAIS ***
        const gridContainer = document.getElementById('interactive-grid');
        const totalValueDisplay = document.getElementById('total-value');
        const progressPercentageDisplay = document.getElementById('progress-percentage');
        
        const numCells = 100; // 10x10
        const valuePerCell = 50; // R$ 50
        let paintedCount = 0; 

        // CHAVE ÚNICA para salvar/carregar dados no LocalStorage
        const STORAGE_KEY = 'vendasGridState';

        // *** FUNÇÕES DE PERSISTÊNCIA (Local Storage) ***

        // 1. Carrega o estado salvo quando a página é aberta
        function loadGridState() {
            // Tenta obter os dados salvos no navegador
            const storedState = localStorage.getItem(STORAGE_KEY);
            // Se houver dados, converte a string JSON de volta para um array de índices
            if (storedState) {
                return JSON.parse(storedState);
            }
            // Se não houver, retorna um array vazio
            return [];
        }

        // 2. Salva o estado atual da grade
        function saveGridState() {
            // Seleciona todos os quadrados que têm a classe 'pintado'
            const paintedCells = document.querySelectorAll('.grid-item.pintado');
            
            // Cria um array apenas com os índices (data-index) desses quadrados
            const stateToSave = Array.from(paintedCells).map(cell => cell.dataset.index);
            
            // Converte o array para uma string JSON e salva no LocalStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(stateToSave));
        }

        // *** FUNÇÕES DE INTERAÇÃO E CONTAGEM ***

        // 3. Função que será executada ao clicar no quadrado
        function toggleColor(event) {
            const clickedCell = event.target;
            
            // Alterna a classe 'pintado'
            const isPainted = clickedCell.classList.toggle('pintado');
            
            // Atualiza o contador de células pintadas
            if (isPainted) {
                paintedCount++;
            } else {
                paintedCount--;
            }
            
            // Salva o novo estado da grade no Local Storage
            saveGridState(); 
            
            // Atualiza os displays de valor e porcentagem
            updateCounters();
        }
        
        // 4. Função para recalcular e exibir os dados
        function updateCounters() {
            // A. Cálculo do Valor Total
            const totalValue = paintedCount * valuePerCell;
            totalValueDisplay.textContent = 'R$ ' + totalValue.toFixed(2).replace('.', ','); 
            
            // B. Cálculo da Porcentagem
            const percentage = (paintedCount / numCells) * 100;
            progressPercentageDisplay.textContent = percentage.toFixed(0) + '%'; 
        }

        // *** INICIALIZAÇÃO DA GRADE ***
        
        // Obtém o estado salvo antes de criar a grade
        const savedPaintedIndices = loadGridState();
        
        for (let i = 0; i < numCells; i++) {
            const cell = document.createElement('div');
            cell.classList.add('grid-item');
            cell.textContent = '50R$';
            
            // Adiciona o índice como um atributo de dados (essencial para salvar/carregar)
            cell.dataset.index = i; 
            
            // Checa se este índice estava no estado salvo
            if (savedPaintedIndices.includes(String(i))) {
                cell.classList.add('pintado');
                paintedCount++; // Conta os quadrados carregados para o total inicial
            }
            
            cell.addEventListener('click', toggleColor);
            gridContainer.appendChild(cell);
        }

        // Atualiza os contadores com o estado carregado
        updateCounters(); 
    </script>

</body>
</html>
